= Apache Arrowã®\nRubyãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’\nGObject Introspectionã§

: author
   é ˆè—¤åŠŸå¹³
: institution
   æ ªå¼ä¼šç¤¾ã‚¯ãƒªã‚¢ã‚³ãƒ¼ãƒ‰
: content-source
   åå¤å±‹Rubyä¼šè­°03
: date
   2017-02-11
: allotted-time
   50m
: theme
   .

= å†…å®¹

  (1) ã¾ãã‚‰
  (2) æœ¬é¡Œ
  (3) ã‚ªãƒ

= ã‚„ã‚ŠãŸã„ã“ã¨

Rubyã§\n
ãƒ‡ãƒ¼ã‚¿åˆ†æ

= ãƒ‡ãƒ¼ã‚¿åˆ†æï¼Ÿ

ã„ã‚ã„ã‚ã‚ã‚‹

= ã‚„ã‚ŠãŸã„ãƒ‡ãƒ¼ã‚¿åˆ†æ

(('tag:center'))
å…¨æ–‡æ¤œç´¢é–¢é€£

  * åŒç¾©èªãƒ»é–¢é€£èªã®è‡ªå‹•æŠ½å‡º\n
    ä¾‹ï¼šæ•´æ•°ã¨Integerã¯åŒã˜
  * æœ€è¿‘ã‚¢ãƒ„ã„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®æŠ½å‡º
  * ...

= èª²é¡Œ

  * é“å…·ãŒè¶³ã‚Šãªã„
    * ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ãŒãªã„ãƒ»\n
      ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã•ã‚Œã¦ã„ãªã„
  * é“å…·ãŒä½¿ã„ã«ãã„

= è§£æ±ºæ–¹æ³•

ã‚„ã‚‹\n
(('note:ï¼ˆé“å…·ã‚’æ•´å‚™ã™ã‚‹ï¼‰'))

= ä¸–é–“ã®æ§˜å­

  * ä¸»ã«Javaã¨Pythonã‚’ä½¿ã†
    * é“å…·ãŒæƒã£ã¦ã„ã‚‹
  * çµ„ã¿åˆã‚ã›ã¦ãƒ‡ãƒ¼ã‚¿åˆ†æ

= çµ„ã¿åˆã‚ã›ãŸæ§˜å­

  # image
  # src = images/copy-data-between-system.png
  # relative_width = 100

(('note:https://arrow.apache.org/ã‚ˆã‚Šï¼ˆApache License 2.0ï¼‰'))

= çµ„ã¿åˆã‚ã›ã®èª²é¡Œ

  * ãƒ‡ãƒ¼ã‚¿äº¤æ›ã‚³ã‚¹ãƒˆãŒé«˜ã„
    * ãƒ‡ãƒ¼ã‚¿ã®ç›´åˆ—åŒ–ã§CPUã®8å‰²ã‚’ä½¿ç”¨\n
      by https://arrow.apache.org/

= è§£æ±ºæ–¹æ³•

ãƒ‡ãƒ¼ã‚¿ã®\n
ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’\n
çµ±ä¸€ã—ã‚ˆã†ï¼

= çµ±ä¸€ã—ãŸæ§˜å­

  # image
  # src = images/share-data-between-system.png
  # relative_width = 100

(('note:https://arrow.apache.org/ã‚ˆã‚Šï¼ˆApache License 2.0ï¼‰'))

= ã“ã‚Œã¯ãƒãƒ£ãƒ³ã‚¹ï¼

  * Rubyã§ã‚‚ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ã¨â€¦
    * æ—¢å­˜ã®ã‚·ã‚¹ãƒ†ãƒ ã¨ã‚„ã‚Šã¨ã‚Šã§ãã‚‹
    * ã€Œã“ã®éƒ¨åˆ†ã ã‘ã¯Rubyã‚’ä½¿ã†ã€ã‚’\n
      ã§ãã‚‹

= ä¸€éƒ¨ã§Ruby

  # image
  # src = images/system-with-ruby.png
  # relative_width = 100

(('note:å‰è¿°ã®å›³ã‚’å¤‰æ›´ï¼ˆApache License 2.0ï¼‰'))

= ä¸€éƒ¨ã§Rubyã‚’â€¦ä½¿ãˆã‚‹ï¼Ÿ

é“å…·ãŒ\n
ãªã„ã˜ã‚ƒã‚“ï¼

= é“å…·

  # image
  # src = images/rroonga-logo.svg
  # relative_width = 100

(('note:Groongãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆCC BY 3.0ï¼‰'))

= Rroonga

  * å…¨æ–‡æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³((*ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼*))
    * SQLã¨ã‹ã˜ã‚ƒãªã\n
      ((*ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ*))ã¨ã—ã¦è§¦ã‚Œã‚‹

= ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä¾‹

è»¢ç½®ç´¢å¼•\n
ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

= è»¢ç½®ç´¢å¼•

(('tag:center'))
é›‘ãªèª¬æ˜

  * (({Hash}))ã¿ãŸã„ãªã‚‚ã®
  * ã‚­ãƒ¼ï¼š
    * ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆå˜èªã¿ãŸã„ãªã‚‚ã®ï¼‰
  * å€¤ï¼š
    * ã‚­ãƒ¼ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ã‚’å«ã‚€æ–‡æ›¸ã®ä¸€è¦§

= è»¢ç½®ç´¢å¼•ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ1ï¼‰

  # coderay ruby

  index = Groonga["Words.index"]
  token = "ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ"
  p index[token] # => 19048
  # ã€Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€ã‚’å«ã‚€æ–‡æ›¸ã¯
  # ç´„19048å€‹ã‚ã‚Šãã†

= è»¢ç½®ç´¢å¼•ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ2ï¼‰

  # coderay ruby

  index.open_cursor(token) do |cursor|
    # æœ€åˆã®å‡ºç¾æƒ…å ±
    posting = cursor.next
    # ã€Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€ã‚’å«ã‚€æœ€åˆã®æ–‡æ›¸ã®ID
    p posting.record.id # => 17
    # ã“ã®æ–‡æ›¸ãŒä½•å€‹ã€Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€ã‚’å«ã‚€ã‹
    p posting.term_frequency # => 1
    # æ–‡æ›¸ã®å†…å®¹
    puts posting.record.document
  end

= åˆ†æã«ä½¿ã£ã¦ã¿ã‚ˆã†

ã‚‹ã‚Šã¾ã‚’åˆ†æ\n
â†“\n
é–¢é€£èªã‚’æŠ½å‡º

= é–¢é€£èªã®æŠ½å‡ºæ–¹æ³•ä¾‹

  (1) æ–‡æ›¸ã‚’å‰å‡¦ç†
  (2) å…¨æ–‡æ›¸ã‚’ãƒˆãƒ”ãƒƒã‚¯ã«åˆ†é¡\n
      * ã©ã‚“ãªãƒˆãƒ”ãƒƒã‚¯ãŒã‚ã‚‹ã‹ã¯å­¦ç¿’
  (3) åŒã˜ãƒˆãƒ”ãƒƒã‚¯ã§ä½¿ã‚ã‚Œã‚„ã™ã„\n
      å˜èªã‚’æŠ½å‡º\n
      â†’é–¢é€£èªï¼

= æ–‡æ›¸ã®å‰å‡¦ç†

å˜èªã®å‡ºç¾é »åº¦\n
(('note:ï¼ˆBag of Wordsã¨ã„ã†ï¼‰'))\n
ã«å¤‰æ›

= å˜èªã®å‡ºç¾é »åº¦

  # coderay ruby
  "åå¤å±‹ãƒã‚¸åå¤å±‹"
  # â†“
  {
    "åå¤å±‹" => 2, # 2å›
    "ãƒã‚¸"   => 1, # 1å›
  }

= å˜èªã¯æ•°å€¤ã«å¤‰æ›

  # coderay ruby

  # "åå¤å±‹" => 10
  # "ãƒã‚¸"   => 20
  {
    10 => 2, # ã€Œåå¤å±‹ã€2å›
    20 => 1, # ã€Œãƒã‚¸ã€1å›
  }

= ãªã‚“ã§æ•°å€¤ã«ã™ã‚‹ã®ï¼Ÿ

è¨ˆç®—ã—ã‚„ã™ã„

= Rroongaã§å‰å‡¦ç†ã§ãã‚‹ï¼Ÿ

  * å‡ºç¾å›æ•°ã¯æ±‚ã‚ã‚‰ã‚Œã‚‹ï¼Ÿ
    * ğŸ‘Œï¼š(({posting.term_frequency}))
  * å˜èªã‚’æ•°å€¤ã«å¤‰æ›ã§ãã‚‹ï¼Ÿ
    * ğŸ‘Œï¼šå…¨æ–‡æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã®å¿…é ˆæ©Ÿèƒ½

= Rroongaã§å‰å‡¦ç†ï¼ˆ1ï¼‰

  # coderay ruby

  bow = {} # ã€Œåå¤å±‹ã€ã®åˆ†ã ã‘
  index.open_cursor("åå¤å±‹") do |cursor|
    cursor.each do |posting|
      record_id      = posting.record_id
      term_id        = posting.term_id # "åå¤å±‹"ã®ID
      term_frequency = posting.term_frequency # å‡ºç¾å›æ•°
      bow[record_id] ||= {}
      bow[record_id][term_id] = term_frequency
      # bow: { # â†“å®Ÿéš›ã¯æ–‡å­—åˆ—ã˜ã‚ƒãªãã¦ID
      #   2 => {"åå¤å±‹" => 9}  # æ–‡æ›¸2ã§ã¯9å›å‡ºç¾
      #   5 => {"åå¤å±‹" => 19} # æ–‡æ›¸5ã§ã¯19å›å‡ºç¾
      # }
    end
  end

= Rroongaã§å‰å‡¦ç†ï¼ˆ2ï¼‰

  # coderay ruby

  bow = {}
  index.table.each do |token| # å…¨ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‡¦ç†
    index.open_cursor(token) do |cursor|
      cursor.each do |posting|
        # ...åŒã˜...
      end
    end
  end
  # bow: { # å®Œæˆï¼
  #   2 => {"åå¤å±‹" => 9,  "ãƒã‚¸" => 2}
  #   5 => {"åå¤å±‹" => 19, "å¯„å¸­" => 1},
  #   ...
  # }

= å‰å‡¦ç†çµ‚ã‚ã‚Š

  * æ¬¡ã¯ãƒˆãƒ”ãƒƒã‚¯ã«åˆ†é¡
    * ã©ã‚“ãªãƒˆãƒ”ãƒƒã‚¯ãŒã‚ã‚‹ã‹ã¯å­¦ç¿’

= ãƒˆãƒ”ãƒƒã‚¯ã®å­¦ç¿’æ–¹æ³•

(('tag:center'))
(('tag:x-large'))
LDA\n
(('note:ï¼ˆLatent Dirichlet Allocation/æ½œåœ¨çš„ãƒ‡ã‚£ãƒªã‚¯ãƒ¬é…åˆ†æ³•ï¼‰'))

(('note:ä»–ã«ã‚‚è‰²ã€…ã‚ã‚‹'))\n
(('note:å‚è€ƒï¼šhttp://www.ism.ac.jp/~daichi/lectures/H24-TopicModel/ISM-2012-TopicModels-daichi.pdf'))

= Rubyã§LDA

lda-ruby gem

= Rubyã§LDAã‚’ã—ãªã„ï¼

ãªãœãªã‚‰ï¼\n
Apache Arrowã¨ã‹\n
GObject Introspectionã®\n
è©±ã‚’ã™ã‚‹\n
æ©Ÿä¼šãŒãªããªã‚‹ã‹ã‚‰ã ï¼

= Pythonã§LDA

scikit-learn

= scikit-learnã§LDA

  # coderay python
  import sklearn.decomposition
  LDA = sklearn.decomposition.LatentDirichletAllocation
  model = LDA(n_topics=100, # 100ãƒˆãƒ”ãƒƒã‚¯ã«åˆ†é¡
              learning_method="online",
              total_samples=10000) # æ–‡æ›¸æ•°ã¯1ä¸‡
  for words in bag_of_words: # å‰å‡¦ç†çµæœ
    model.partial_fit(words) # è¦ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›
  model.components_ # ã“ã“ã«å­¦ç¿’ã—ãŸãƒˆãƒ”ãƒƒã‚¯ãŒã‚ã‚‹

= å‰å‡¦ç†çµæœãŒãªã„ï¼

  * å‰å‡¦ç†ã¯Rubyã§ã‚„ã£ãŸ
    * å‰å‡¦ç†çµæœãŒãªã„ã¨\n
      scikit-learnã§åˆ†æã§ããªã„ï¼
  * ã©ã†ã—ã‚ˆã†ï¼
    * (('wait'))ãã†ã ï¼Apache Arrowã ï¼

= Arrowã§ã¤ãªãŒã‚‹ä¸–ç•Œ

  # image
  # src = images/system-with-ruby.png
  # relative_width = 100

(('note:ï¼ˆApache License 2.0ï¼‰'))

= Rubyã§Arrow

  * Arrowã¯C++ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼
    * Rubyã‹ã‚‰ã¯ä½¿ãˆãªã„
  * ã©ã†ã—ã‚ˆã†ï¼
    * (('wait'))ã‚„ã‚‹ï¼ˆãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’ä½œã‚‹ï¼‰

= Arrowã®ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°

  * arrow-glib
    * github.com/kou/arrow-glib
    * Arrowã®ãƒ©ãƒƒãƒ‘ãƒ¼ãƒ»C APIã‚’æä¾›
  * GObject Introspectionå¯¾å¿œ
    * ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’å®Ÿè¡Œæ™‚ã«ç”Ÿæˆ

= ä½¿ã„æ–¹ï¼šæº–å‚™

  # coderay ruby
  require "gi"
  Arrow = GI.load("Arrow")

= ä½¿ã„æ–¹ï¼šé…åˆ—ã‚’ä½œã‚‹

  # coderay ruby

  # Arrowã¯é«˜é€Ÿã«1æ¬¡å…ƒãƒ»2æ¬¡å…ƒé…åˆ—ã‚’
  # æ‰±ã†APIã‚’æä¾›ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼
  builder = Arrow::UInt32ArrayBuilder.new
  builder.append(29)
  builder.append(9)
  term_ids = builder.finish
  p term_ids.length       # => 2
  p term_ids.get_value(0) # => 29
  p term_ids.get_value(1) # => 9

= å°‘ã—â€¦ä½¿ã„ã«ãã„ï¼

  * GObject Introspection
    * ã ã„ãŸã„ã„ã„æ„Ÿã˜ã«ãªã‚‹ï¼(('note:ï¼ˆã™ã”ã„ï¼ï¼‰'))
    * ãŒï¼Rubyç‰¹æœ‰ã®ã¨ã“ã‚ã¯ä¸€æ‰‹é–“å¿…è¦

= ä½¿ã„ã‚„ã™ã•æ¤œè¨

  # coderay ruby

  builder = Arrow::UInt32ArrayBuilder.new
  builder.append(29)
  builder.append(9)
  term_ids = builder.finish
  # â†“
  term_ids = Arrow::UInt32ArrayBuilder.build([29, 9])

= ä¸€æ‰‹é–“

  # coderay ruby
  module Arrow
    class ArrayBuilder
      class << self
        def build(values)
          builder = new
          values.each do |value|
            builder.append(value)
          end
          builder.finish
        end
      end
    end
  end

= ã‚‚ã†ä¸€æ‰‹é–“

  # coderay ruby

  module Arrow
    class UInt32Array
      class << self
        def new(values)
          UInt32ArrayBuilder.build(values)
        end
      end
    end
  end

= ä¸€æ‰‹é–“å¾Œ

  # coderay ruby

  builder = Arrow::UInt32ArrayBuilder.new
  builder.append(29)
  builder.append(9)
  term_ids = builder.finish
  # â†“
  term_ids = Arrow::UInt32Array.new([29, 9])

= ã•ã‚‰ã«ä½¿ã„ã‚„ã™ã•æ¤œè¨

  # coderay ruby

  p term_ids.get_value(0) # => 29
  p term_ids.get_value(1) # => 9
  # â†“
  p term_ids[0] # => 29
  p term_ids[1] # => 9

= äºŒæ‰‹é–“

  # coderay ruby
  module Arrow
    class Array
      def [](i)
        get_value(i)
      end
    end
  end

= ã‚‚ã†ä¸€æ‰‹é–“

  # coderay ruby
  module Arrow
    class Array
      include Enumerable
      def each
        length.times do |i|
          yield(self[i])
        end
      end
    end
  end

= äºŒæ‰‹é–“å¾Œ

  # coderay ruby

  p term_ids.get_value(0) # => 29
  p term_ids.get_value(1) # => 9
  # â†“
  p term_ids.to_a # => [29, 9]

= ä¸€æ‰‹é–“ã¯ã©ã“ã«æ›¸ãã®ï¼Ÿ

  # coderay ruby

  # ã“ã†ï¼Ÿ
  require "gi"
  Arrow = GI.load("Arrow")
  module Arrow
    class Array
      # ...
    end
  end

= é•ã†ï¼

  * (({GI.load}))ã¯ãƒ‡ãƒ¢ç”¨ã®API
    * ã¡ã‚ƒã‚“ã¨ä½œã‚‹ã¨ãã¯ä½¿ã‚ãªã„
  * (({GI::Loader}))ã‚’ç¶™æ‰¿
    * (({#post_load}))ãƒ•ãƒƒã‚¯æ™‚ã«ä¸€æ‰‹é–“

= (({GI::Loader#post_load}))

  # coderay ruby

  module Arrow
    class Loader < GI::Loader
      private
      def post_load(*args)
        require "arrow/array"
        require "arrow/array-builder"
      end
    end
  end

= (({arrow/array.rb}))

  # coderay ruby

  module Arrow
    class Array
      include Enumerable
      def each
        length.times do |i|
          yield(self[i])
        end
      end
    end
  end

= (({arrow.rb}))

  # coderay ruby

  require "arrow/loader"
  module Arrow
    Loader.load("Arrow", self)
    # â†‘ã®ä¸­ã§#post_loadãŒå‘¼ã°ã‚Œã‚‹
  end

= ä½¿ã„æ–¹

  # coderay ruby

  require "arrow"

  term_ids = Arrow::UInt32Array.new([29, 9])
  p term_ids.to_a # => [29, 9]

= ã™ã”ã„ï¼

Rubyã£ã½ã„ï¼

= å®Ÿè£…

  * RArrow
    * http://github.com/kou/rarrow
  * ä»–ã®ä¸€æ‰‹é–“ä¾‹ã‚‚ã‚¢ãƒª
    * ä¾‹ï¼š(({.open {|io| ...}}))ã§è‡ªå‹•(({close}))

= å‰å‡¦ç†çµæœã‚’æ¸¡ã™

  * å¿˜ã‚Œã¦ã„ãŸã§ã—ã‚‡ï¼Ÿ
    * Arrowã®è©±ã‚’ã—ã¦ã„ãŸã®ã¯ã“ã®ãŸã‚
  * æ‰‹é †
    (1) Rubyã§æ›¸ãå‡ºã—
    (2) Pythonã§èª­ã¿è¾¼ã¿

= Rubyã§æ›¸ãå‡ºã—

  # coderay ruby

  FOS = Arrow::IO::FileOutputStream # é•·ã„ã‹ã‚‰
  SW = Arrow::IPC::StreamWriter     # é•·ã„ã‹ã‚‰
  FOS.open("/tmp/bow", false) do |output_stream|
    # schemaï¼šã‚«ãƒ©ãƒ åã¨å‹ã®å®šç¾©ï¼ˆçœç•¥ï¼‰
    SW.open(output_stream, schema) do |writer|
      bow.each do |record_id, words|
        # record_batchï¼ˆçœç•¥ï¼‰ï¼š
        # ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰Nè¡Œã ã‘æŠœãå‡ºã—ãŸã‚‚ã®
        writer.write_record_batch(record_batch)
      end
    end
  end

= Pythonã§èª­ã¿å‡ºã—

  # coderay python

  from scipy.sparse import csr_matrix
  import pandas as pd
  import pyarrow as A
  with A.io.MemoryMappedFile("/tmp/bow", "rb") as source:
      reader = A.ipc.StreamReader(source)
      for record_batch in reader: # ã‚¹ãƒˆãƒªãƒ¼ãƒ ã§é †ã«å‡¦ç†
          # Pandasã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã«å¤‰æ›
          df = record_batch.to_pandas()
          # ç–ãªè¡Œåˆ—ã«å¤‰æ›
          corpus = csr_matrix((df["score"].values,
                               df["term_id"].values,
                               [0, df["term_id"].size]),
                              shape=(1, n_features))
          model.partial_fit(corpus) # å­¦ç¿’

= ãƒˆãƒ”ãƒƒã‚¯ã‚’ç¢ºèª

  # coderay python

  for topic in model.components_:
      n_top_terms = 10
      # ã“ã®ãƒˆãƒ”ãƒƒã‚¯ã«é–¢é€£ã—ã¦ã„ã‚‹
      # ä¸Šä½10å˜èªã‚’è¨ˆç®—
      top_term_indexes =
          topic.argsort()[:-n_top_terms-1:-1]
      for i in top_term_indexes:
          term_id = i      # å˜èªID
          score = topic[i] # é–¢é€£åº¦
          print("%s:%s" % (term_id, score))

= å˜èªIDã˜ã‚ƒã‚ã‹ã‚‰ã‚“ï¼

  * å˜èªã¯æ•°å€¤ã«ã—ã¦è¨ˆç®—ã—ãŸ
    * å˜èªãã®ã‚‚ã®ã‚’ç¢ºèªã—ãŸã„ï¼
  * å˜èªã¨IDã®ç®¡ç†ã¯â€¦Rroongaï¼
    * ãƒˆãƒ”ãƒƒã‚¯ã‚’Rubyã«æŒã£ã¦ã„ã‹ãªã„ã¨
    * (('wait'))ãã†ã ï¼Apache Arrowã ï¼

= Arrowã§ã¤ãªãŒã‚‹ä¸–ç•Œ

  # image
  # src = images/system-with-ruby.png
  # relative_width = 100

(('note:ï¼ˆApache License 2.0ï¼‰'))

= Pythonã§æ›¸ãå‡ºã—

  # coderay python

  with open("/tmp/topics", "wb") as sink:
      # schemaï¼šbatch.schemaã§å–å¾—ã§ãã‚‹ï¼ˆçœç•¥ï¼‰
      writer = A.ipc.StreamWriter(sink, schema)
      def topic_to_df(topic):
          # å‰è¿°ã®ãƒˆãƒ”ãƒƒã‚¯ã‚’ç¢ºèªã—ãŸå‡¦ç†ã¨åŒã˜
          values = [[i, topic[i]]
                    for i in topic.argsort()[:-10-1:-1]]
          return pd.DataFrame(values,
                              columns=["term_id", "score"])
      for topic in model.components_:
          df = topic_to_df(topic)
          batch = A.RecordBatch.from_pandas(df)
          writer.write_batch(batch)
      writer.close()

= Rubyã§èª­ã¿è¾¼ã¿

  # coderay ruby

  MMF = Arrow::IO::MemoryMappedFile # é•·ã„ã‹ã‚‰
  SR = Arrow::IPC::StreamReader     # é•·ã„ã‹ã‚‰
  MMF.open("/tmp/topics", :read) do |input|
    SR.open(input) do |reader|
      reader.each do |record_batch|
        record_batch.each do |record|
          # æœ¬å½“ã¯é–¢é€£åº¦ãŒé«˜ã„ã‚‚ã®ã ã‘è¡¨ç¤º
          p [record["term_id"], record["score"]]
        end
      end
    end
  end

= å®Ÿéš›ã®çµæœ

  1: uzqpuaglzig, ã‚ãã‚‰ã‚, ã”è¦§
  2: useloopback, ã‚¿ã‚¹ã‚¯
  3: ãƒ—ãƒ©ãƒƒãƒˆãƒ›ãƒ¼ãƒ , mydog
  4: delegateclass, barbar
  ...

(('tag:center'))
(('wait'))å¾®å¦™â€¦

= å¤§äº‹ãªã“ã¨

Garbage in,\n
Garbage out

= å‰å‡¦ç†ã‚’ãŒã‚“ã°ã‚‹

  * ã„ã‚‰ãªã„æ–‡æ›¸ã‚’ç„¡è¦–
  * ã„ã‚‰ãªã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç„¡è¦–

= ã„ã‚‰ãªã„æ–‡æ›¸ã‚’ç„¡è¦–

  # coderay ruby

  entries = Groonga["Entries"]
  # å…¨æ–‡æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã§æ¤œç´¢ã™ã‚‹ã®ã§é«˜é€Ÿï¼ã™ã”ã„ï¼
  target_entries = entries.select do |record|
    (record.version == "2.4.0") -
      (record.document =~ "@todo")
      # â†‘@todoãªæ–‡æ›¸ã‚’å¯¾è±¡å¤–
  end
  # ... do |posting|
    # å­˜åœ¨ãƒã‚§ãƒƒã‚¯ã‚‚å…¨æ–‡æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ãŒã‚„ã‚‹ã®ã§é«˜é€Ÿï¼
    next if target_entries.key?(posting.record_id)
  # ... end

= ã„ã‚‰ãªã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç„¡è¦–

  # coderay ruby

  n_entries = target_entries.size
  # ã»ã¨ã‚“ã©ã®æ–‡æ›¸ã«å«ã¾ã‚Œã‚‹ãªã‚‰é‡è¦ã˜ã‚ƒãªã„
  too_many_threshold = n_entries * 0.9
  # ã”ãä¸€éƒ¨ã®æ–‡æ›¸ã«ã—ã‹å«ã¾ã‚Œãªã„ãªã‚‰é‡è¦ã˜ã‚ƒãªã„
  too_less_threshold = n_entries * 0.01
  # ... do |term|
    n_match_documents = index.estimate_size(term)
    next if n_match_documents >= too_much_threshold
    next if n_match_documents <= too_less_threshold
  # ... end

= å®Ÿéš›ã®çµæœ

  1: self, ãƒ–ãƒ­ãƒƒã‚¯
  2: each, enumerator
  3: integer, æ•´æ•°, è¡¨ç¤º
  4: ruby, object
  ...

(('tag:center'))
(('wait'))ãã‚Œã£ã½ããªã£ã¦ããŸï¼

= ã¾ã¨ã‚ï¼ˆ1ï¼‰

  * Rubyã§ãƒ‡ãƒ¼ã‚¿åˆ†æ
    * å…¨éƒ¨ã¯ãƒ ãƒª
    * ã§ã‚‚ä¸€éƒ¨ãªã‚‰ã„ã‘ã‚‹

= ã¾ã¨ã‚ï¼ˆ2ï¼‰

  * ä¸€éƒ¨ãªã‚‰ã„ã‘ã‚‹ã®ã¯â€¦
    * Apache Arrowã®ç™»å ´\n
      ãƒ‡ãƒ¼ã‚¿äº¤æ›ã—ã‚„ã™ããªã‚‹
    * Rroongaã®å­˜åœ¨\n
      Rubyã§é«˜é€Ÿã«è‡ªç„¶è¨€èªå‡¦ç†ã§ãã‚‹

= ã¾ã¨ã‚ï¼ˆ3ï¼‰

  * Rubyã§Apache Arrow
    * ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãŒå¿…è¦
    * GObject Introspection\n
      ãƒ™ãƒ¼ã‚¹ã§ä½œã£ãŸï¼ˆarrow-glibï¼‰

= ã¾ã¨ã‚ï¼ˆ4ï¼‰

  * GObject Introspection
    * ã ã„ãŸã„ã„ã„æ„Ÿã˜
    * ã•ã‚‰ã«ä¸€æ‰‹é–“ã§ã‚°ãƒƒã¨ã‚ˆããªã‚‹

= ã¾ã¨ã‚ï¼ˆ5ï¼‰

  * å®Ÿéš›ã«åˆ†æã—ã¦ã¿ãŸ
    * Rubyã§å‰å‡¦ç†\n
      â†“Arrow
    * Pythonã§åˆ†æ\n
      â†“Arrow
    * Rubyã§ç¢ºèª\n
      (('note:ï¼ˆæœ¬å½“ã¯å…¨æ–‡æ¤œç´¢ç”¨DBã«å…¥ã‚Œã¦æ´»ç”¨ã™ã‚‹ï¼‰'))

= ã¾ã¨ã‚ï¼ˆ6ï¼‰

  * Rubyã§ãƒ‡ãƒ¼ã‚¿åˆ†æã„ã‘ãã†ï¼
    * Arrowã§ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ãŒå®¹æ˜“ã«\n
      â†’åˆ†æå‡¦ç†ã¸ã®Rubyã®å‚åŠ ãŒå®¹æ˜“ã«
    * Rroongaã§Rubyã§ã‚‚é«˜é€Ÿã«\n
      è‡ªç„¶è¨€èªå‡¦ç†ã‚’ã§ãã‚‹

= ãŠã—ã‚‰ã›ï¼ˆ1ï¼‰

    * Rubyã§ãƒ‡ãƒ¼ã‚¿åˆ†æã—ãŸã„äººã¯\n
      ã‚¯ãƒªã‚¢ã‚³ãƒ¼ãƒ‰ã«ç›¸è«‡ã—ã¦ã­ï¼
      * é“å…·ã®ç”¨æ„ãƒ»æ´»ç”¨ã‚’æ‰‹ä¼ãˆã‚‹

  # image
  # src = images/clear-code.svg
  # relative_width = 100

= ãŠã—ã‚‰ã›ï¼ˆ2ï¼‰

    * Groonga Meatupåå¤å±‹2017\n
      é–‹å‚¬ï¼
      * æ™‚é–“ï¼šæ˜æ—¥ã®åˆå‰ï¼ˆ10:00-ï¼‰
      * å ´æ‰€ï¼šMisoca

  # image
  # src = images/groonga-logo.svg
  # relative_height = 100
